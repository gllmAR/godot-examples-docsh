name: ğŸ“Š Status Report

on:
  workflow_run:
    workflows: ["ğŸ® Build Godot Examples Documentation"]
    types:
      - completed
  workflow_dispatch:

jobs:
  status-report:
    name: ğŸ“Š Status Report
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Generate status report
        run: |
          # Get workflow status (handle both workflow_run and manual triggers)
          if [ "${{ github.event_name }}" = "workflow_run" ]; then
            WORKFLOW_STATUS="${{ github.event.workflow_run.conclusion }}"
          else
            WORKFLOW_STATUS="success"
          fi
          
          # Count projects and exports
          PROJECT_COUNT=$(find godot-demo-projects -name "project.godot" 2>/dev/null | wc -l || echo "0")
          EXPORT_COUNT=$(find godot-demo-projects -name "index.html" -path "*/exports/*" 2>/dev/null | wc -l || echo "0")
          
          # Display status report
          echo "ğŸ® Godot Examples Documentation Status Report"
          echo "=============================================="
          echo ""
          echo "ğŸ“Š Build Status: $WORKFLOW_STATUS"
          echo "ğŸ“ Total Projects: $PROJECT_COUNT"
          echo "ğŸŒ Exported Projects: $EXPORT_COUNT"
          echo "ğŸ¯ Godot Version: 4.3"
          echo ""
          
          if [ "$WORKFLOW_STATUS" = "success" ]; then
            echo "âœ… Build completed successfully!"
          elif [ "$WORKFLOW_STATUS" = "failure" ]; then
            echo "âŒ Build failed!"
          else
            echo "âš ï¸  Build status unknown"
          fi
          
          if [ "$PROJECT_COUNT" -gt 0 ]; then
            echo "âœ… Projects found: $PROJECT_COUNT"
          else
            echo "âŒ No projects found (submodule issue?)"
          fi
          
          if [ "$EXPORT_COUNT" -gt 0 ]; then
            echo "âœ… Exports generated: $EXPORT_COUNT"
          else
            echo "âŒ No exports found"
          fi
